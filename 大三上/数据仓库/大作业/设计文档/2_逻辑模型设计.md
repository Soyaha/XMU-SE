# 淘宝用户行为数据仓库 - 逻辑模型设计

## 1. 数据仓库分层架构

本项目采用标准的四层数据仓库架构：

1.  **ODS (Operational Data Store) 原始数据层**:
    *   直接映射源数据结构，不做清洗。
    *   存储格式：文本文件 (CSV/Text)。
    *   保留原始历史数据，作为数据湖。

2.  **DIM (Dimension) 公共维度层**:
    *   存储业务维度的描述信息（用户、商品、时间等）。
    *   采用统一的维度定义，保证全域一致性。
    *   存储格式：列式存储 (ORC)。

3.  **DWD (Data Warehouse Detail) 明细事实层**:
    *   对ODS层数据进行清洗（去噪、空值处理、时区修复）。
    *   将事实数据与维度ID关联（退化维度或外键）。
    *   保持最细粒度（单次行为）。
    *   存储格式：列式存储 (ORC) + Snappy压缩。

4.  **DWS (Data Warehouse Service) 汇总事实层**:
    *   按业务主题（用户、类目）进行轻度聚合。
    *   粒度上卷（如：按天汇总）。
    *   为上层应用提供高性能查询支持。

5.  **ADS (Application Data Service) 应用数据层**:
    *   面向具体业务报表和KPI指标。
    *   高度聚合，结果集较小。
    *   直接对接可视化工具。

## 2. 逻辑表结构设计

### 2.1 ODS 层
| 表名 | 描述 | 关键字段 |
| :--- | :--- | :--- |
| `ods.taobao_user_behavior_ods` | 原始用户行为日志 | `user_id`, `item_id`, `category_id`, `behavior_type`, `log_ts` |

### 2.2 DIM 层 (维度模型)
采用星型模型 (Star Schema) 构建。

**1. 时间维度表 (`dim.dim_time`)**
*   主键: `dt` (日期)
*   属性: `year`, `month`, `day`, `hour`, `week`, `is_weekend`

**2. 用户维度表 (`dim.dim_user`)**
*   主键: `user_id`
*   属性: `user_lv` (等级), `reg_dt` (注册日), `user_city` (城市)

**3. 商品维度表 (`dim.dim_item`)**
*   主键: `item_id`
*   属性: `category_id`, `item_name`, `brand`, `price`

**4. 类目维度表 (`dim.dim_category`)**
*   主键: `category_id`
*   属性: `category_name`, `cate_level`

**5. 行为类型维度表 (`dim.dim_behavior_type`)**
*   主键: `behavior_type`
*   属性: `behavior_name` (中文名), `behavior_weight` (权重)

### 2.3 DWD 层 (明细事实)
**用户行为事实表 (`dwd.taobao_user_behavior_fact`)**
*   **粒度**: 单次行为事件
*   **分区**: `dt` (日期)
*   **字段**:
    *   `user_id` (FK): 关联用户维度
    *   `item_id` (FK): 关联商品维度
    *   `category_id` (FK): 关联类目维度
    *   `behavior_type`: 行为类型
    *   `log_ts`: 原始时间戳
    *   `dt_hh`: 格式化时间 (yyyy-MM-dd HH)

### 2.4 DWS 层 (汇总事实)
**1. 用户日行为汇总表 (`dws.taobao_behavior_user_agg`)**
*   **粒度**: 用户 + 日期
*   **分区**: `dt`
*   **指标**:
    *   `total_behavior_cnt`: 当日总行为数
    *   `buy_cnt`: 当日购买次数
    *   `active_hour`: 当日最活跃小时

**2. 类目日行为汇总表 (`dws.taobao_behavior_cate_agg`)**
*   **粒度**: 类目 + 日期
*   **分区**: `dt`
*   **指标**:
    *   `pv_cnt`: 浏览次数
    *   `cart_cnt`: 加购次数
    *   `fav_cnt`: 收藏次数
    *   `buy_cnt`: 购买次数

### 2.5 ADS 层 (指标应用)
| 表名 | 业务含义 | 核心指标 |
| :--- | :--- | :--- |
| `ads.taobao_conversion_funnel` | 转化漏斗 | PV用户数, 加购用户数, 购买用户数, 各环节转化率 |
| `ads.taobao_hot_item_top10` | 热门商品 | 商品排名, 浏览量, 购买量, 转化率 |
| `ads.taobao_user_dau` | 用户活跃度 | DAU (日活), MAU_7d (7日活), 活跃率 |
| `ads.taobao_traffic_hourly_stats` | 分时流量 | 各小时PV/加购/购买量 |
| `ads.taobao_category_top10` | 热门类目 | 类目排名, 流量, 销量 |
| `ads.taobao_repurchase_stats` | 用户复购 | 购买人数, 复购人数, 复购率 |
